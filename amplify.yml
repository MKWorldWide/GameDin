version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - rm -rf divina-l3 GameDinVR GameDinDiscord
            # Configure git to use the provided GitHub PAT for all github.com URLs
            - git config --global url."https://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@github.com/".insteadOf "https://github.com/"
            - echo "üöÄ Starting GameDin Amplify optimization build..."
            - echo "üì¶ Installing dependencies with optimization..."
            - cd frontend
            - npm ci --ignore-scripts --prefer-offline
            - echo "‚úÖ Dependencies installed successfully"
        build:
          commands:
            - echo "üî® Building optimized GameDin application..."
            - npm run lint
            - npm run type-check
            - npm run test:ci
            - npm run build:optimized
            - echo "‚úÖ Build completed successfully"
        postBuild:
          commands:
            - echo "üìä Generating build analysis..."
            - npm run build:analyze
            - echo "üîç Running security audit..."
            - npm audit --audit-level=moderate
            - echo "‚ö° Optimizing for AWS..."
            - npm run aws:optimize
            - echo "‚úÖ Post-build optimization completed"
      artifacts:
        baseDirectory: frontend/dist
        files:
          - '**/*'
        discard-paths: no
      cache:
        paths:
          - frontend/node_modules/**/*
          - frontend/.cache/**/*
          - frontend/dist/**/*
    appRoot: .
