version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            # Configure git to use the provided GitHub PAT for all github.com URLs
            - git config --global url."https://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@github.com/".insteadOf "https://github.com/"
            - echo "ğŸš€ Starting GameDin Amplify optimization build..."
            - echo "ğŸ“¦ Installing dependencies with optimization..."
            - cd frontend
            - npm ci --ignore-scripts --prefer-offline
            - echo "âœ… Dependencies installed successfully"
        build:
          commands:
            - echo "ğŸ”¨ Building optimized GameDin application..."
            - npm run lint
            - npm run type-check
            - npm run test:ci
            - npm run build:optimized
            - echo "âœ… Build completed successfully"
        postBuild:
          commands:
            - echo "ğŸ“Š Generating build analysis..."
            - npm run build:analyze
            - echo "ğŸ” Running security audit..."
            - npm audit --audit-level=moderate
            - echo "âš¡ Optimizing for AWS..."
            - npm run aws:optimize
            - echo "âœ… Post-build optimization completed"
      artifacts:
        baseDirectory: frontend/dist
        files:
          - '**/*'
        discard-paths: no
      cache:
        paths:
          - frontend/node_modules/**/*
          - frontend/.cache/**/*
          - frontend/dist/**/*
    appRoot: .
